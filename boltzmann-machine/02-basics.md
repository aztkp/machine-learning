# 2. 基礎理論

## ボルツマンマシンの構造

### ユニット（ノード）

ボルツマンマシンは複数の**二値ユニット**で構成されます。

```
各ユニット i の状態: sᵢ ∈ {0, 1} または {-1, +1}
```

ユニットは2種類に分類されます：

```
┌─────────────────────────────────────┐
│  可視ユニット (Visible Units)        │
│  ・外部から観測できる                │
│  ・入力データを表現                  │
│  ・記号: v                          │
└─────────────────────────────────────┘
          ↕ 接続
┌─────────────────────────────────────┐
│  隠れユニット (Hidden Units)         │
│  ・外部から観測できない              │
│  ・データの潜在的な特徴を表現        │
│  ・記号: h                          │
└─────────────────────────────────────┘
```

### 接続（重み）

ユニット間は**対称的な重み**で接続されます：

- $w_{ij}$: ユニット $i$ と $j$ の間の重み
- $w_{ij} = w_{ji}$（対称）
- 自己接続はなし: $w_{ii} = 0$

### バイアス

各ユニットには**バイアス項** $b_i$ があり、そのユニットが活性化しやすいかを決めます。

## 状態と確率分布

### システムの状態

全ユニットの状態をまとめたベクトル：

$$\mathbf{s} = (s_1, s_2, ..., s_n)$$

$n$ 個の二値ユニットがある場合、可能な状態は $2^n$ 通り。

### ボルツマン分布

状態 $\mathbf{s}$ が実現する確率：

$$P(\mathbf{s}) = \frac{1}{Z} e^{-E(\mathbf{s})/T}$$

ここで：
- $E(\mathbf{s})$: 状態のエネルギー
- $T$: 温度パラメータ（通常 $T=1$）
- $Z$: 分配関数

**重要なポイント**：低エネルギーの状態ほど高確率で実現する

### 分配関数

正規化定数（全確率の和を1にする）：

$$Z = \sum_{\mathbf{s}} e^{-E(\mathbf{s})/T}$$

これは全ての可能な状態についての和なので、計算が非常に困難です。

## 状態の更新規則

### 確率的な更新

ユニット $i$ が活性化（$s_i = 1$）する確率：

$$P(s_i = 1) = \sigma\left(\sum_j w_{ij} s_j + b_i\right)$$

ここで $\sigma$ はシグモイド関数：

$$\sigma(x) = \frac{1}{1 + e^{-x}}$$

### 更新の手順

```
1. ユニットをランダムに1つ選ぶ
2. 他のユニットの状態から入力を計算
3. シグモイド関数で確率を計算
4. その確率に従って状態を更新
5. 1-4を繰り返す
```

この過程を十分繰り返すと、システムは**平衡状態**（ボルツマン分布）に収束します。

## 温度の役割

温度 $T$ はシステムの「ランダムさ」を制御します：

| 温度 | 挙動 |
|------|------|
| $T \to 0$ | 最低エネルギー状態のみ選ばれる（決定論的） |
| $T = 1$ | 標準的な確率的動作 |
| $T \to \infty$ | 全ての状態が等確率（完全にランダム） |

### シミュレーテッドアニーリング

高温から始めて徐々に温度を下げることで、より良い解（低エネルギー状態）を見つける手法：

```
T_high → T_medium → T_low
(探索)   (遷移)    (収束)
```

## マルコフ連鎖モンテカルロ（MCMC）

ボルツマンマシンの状態更新は**マルコフ連鎖**を形成します。

```
状態 s(0) → s(1) → s(2) → ... → s(∞)
                                  ↓
                           平衡分布に収束
```

### 詳細つりあい条件

状態 $\mathbf{s}$ から $\mathbf{s}'$ への遷移確率を $T(\mathbf{s} \to \mathbf{s}')$ とすると：

$$P(\mathbf{s}) T(\mathbf{s} \to \mathbf{s}') = P(\mathbf{s}') T(\mathbf{s}' \to \mathbf{s})$$

この条件を満たす更新規則を使うことで、ボルツマン分布への収束が保証されます。

## 可視ユニットと隠れユニット

### なぜ隠れユニットが必要か

可視ユニットだけでは、データの複雑なパターンを表現できません。

**例: XOR問題**

```
入力     出力
(0,0) → 0
(0,1) → 1
(1,0) → 1
(1,1) → 0
```

隠れユニットを追加することで、非線形な関係を学習できます。

### 確率の周辺化

観測データ $\mathbf{v}$ の確率は、隠れ状態について周辺化：

$$P(\mathbf{v}) = \sum_{\mathbf{h}} P(\mathbf{v}, \mathbf{h})$$

---

[← 前へ: 導入と歴史](./01-introduction.md) | [次へ: エネルギー関数 →](./03-energy-function.md)
